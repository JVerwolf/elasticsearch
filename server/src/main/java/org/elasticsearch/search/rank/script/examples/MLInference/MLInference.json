{
  "retriever": {
    "script_rank": {
      "retrievers": [
        {
          "standard": {
            "query": {
              "bool": {
                "should": [
                  {"term": {"kw": {"value": "one"}}},
                  {"term": {"kw": {"value": "two"}}},
                  {"term": {"kw": {"value": "three"}}}
                ]
              }
            }
          }
        }
      ],
      "window_size": 10,
      "queries":[
        {
          "text_expansion":{
            "content_embedding":{
               "model_id":".elser_model_2",
               "model_text":"apache lucene"
            }
          }
        }
      ],
      "script": {
          "source": "StringBuilder sb = new StringBuilder();\nList output = [];\nfor (ScriptRankDoc scriptRankDoc : inputs[0]) {\n    sb.append(scriptRankDoc.queryScores()[0]);\n    sb.append(\"|\");\n            float newScore = scriptRankDoc.queryScores()[0];\n            output.add(new ScoreDoc(scriptRankDoc.scoreDoc().doc, newScore, scriptRankDoc.scoreDoc().shardIndex));\n            sb.append(output.get(output.size() - 1));\n            sb.append(\"|\");\n}\n/*if (output != null) throw new IllegalArgumentException(sb.toString());*/\noutput.sort((ScriptRankDoc sd1, ScriptRankDoc sd2) -> {\n    return sd1.newScore < sd2.newScore ? 1 : -1;\n});\nreturn output;\n"
      }
    }
  },
  "_source": false,
  "fields": ["kw", "v"]
}

